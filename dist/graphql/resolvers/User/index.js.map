{"version":3,"sources":["../../../../src/graphql/resolvers/User/index.js"],"names":["Query","user","root","req","ctx","console","log","findOne","_id","Types","ObjectId","agent","role","player","agentPlayers","find","Agent","agentPlayer","Player","playerCurrentCredit","Mutation","switchPlayerActivate","title","content","status","findOneAndUpdate","$set","isActivate","new","username","playerMutation","isEmpty","passcode","newNickname","nickname","newPassword","password","newPasscode","newInitial","Number","newMaxWin","newMinRisk","isSetNewWagerLimit","newParlay","newParlayTeam","newBasicTeaser","newBasicTeaserTeam","newSpecialTeaser","newSpecialTeaserTeam","newBigTeaser","newBigTeaserTeam","newSuperTeaser","newWinReverse","newWinReverseTeam","newActionReverse","newActionReverseTeam","create","switchUserNotification","Object","keys"],"mappings":"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","file":"index.js","sourcesContent":["import mongoose from 'mongoose';\nimport User from '../../../models/User';\nimport Agent from '../../../models/User.Agent';\nimport Player from '../../../models/User.Player';\nimport BetOrder from '../../../models/BetOrder'\nimport moment from 'moment';\nimport _ from 'lodash';\nimport SystemLog from '../../../models/SystemLog';\n\nimport getPlayerCurrentCredit from '../../../services/getUserCredit/player'\n\nexport const Query = {\n\tuser(root, req, ctx){\n\t\tconsole.log('user')\n\t\treturn User.findOne({ _id: mongoose.Types.ObjectId(ctx.user._id) });\n\t},\n\tagent(root, req, ctx){\n\t\tif(ctx.user && ctx.user.role !== 'Agent') return null;\n\t\treturn Agent.findOne({ _id: mongoose.Types.ObjectId(ctx.user._id) });\n\t},\n\tplayer(root, req, ctx){\n\t\tif(ctx.user.role === 'Guest') return null;\n\t\treturn Player.findOne({ _id: mongoose.Types.ObjectId(ctx.user._id) });\n\t},\n\tagentPlayers(root, req, ctx) {\n\t\tif(ctx.user.role !== 'Agent') return null;\n\t\treturn Player.find({ Agent: mongoose.Types.ObjectId(ctx.user._id) });\n\t},\n\tagentPlayer(root, req, ctx){\n\t\tif(ctx.user.role !== 'Agent' || req.Player === '') return null;\n\t\treturn Player.findOne({ _id: mongoose.Types.ObjectId(req.Player) });\n\t},\n\n\tasync playerCurrentCredit(root, req, ctx){\n\t\treturn getPlayerCurrentCredit(ctx.user._id)\n\t},\n\n};\n\nexport const Mutation = {\n\tasync switchPlayerActivate(root, req, ctx){\n\t\tif(ctx.user.role !== 'Agent') return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\tconst player = await Player.findOneAndUpdate({ Agent: mongoose.Types.ObjectId(ctx.user._id), _id: mongoose.Types.ObjectId(req.Player) }, { $set: { isActivate: req.isActivate } }, { new: true });\n\t\tif(!player) return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\treturn { title: player.username, content: player.isActivate, status: 'success' };\n\t},\n\tasync playerMutation(root, req, ctx){\n\t\ttry { \n\t\t\tif(ctx.user.role !== 'Agent') return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\t\tif(_.isEmpty(req.Player)) return { title: 'Missing Player', content: 'Please try again.', status: 'warning' };\n\t\t\tif(_.isEmpty(req.passcode)) return { title: 'Missing Passcode', content: 'Please try again.', status: 'warning' };\n\t\t\tconst agent = await Agent.findOne({ _id: mongoose.Types.ObjectId(ctx.user._id) }, 'passcode');\n\t\t\tif(agent.passcode !== req.passcode) return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\t\tconst player = await Player.findOne({ Agent: mongoose.Types.ObjectId(ctx.user._id), _id: mongoose.Types.ObjectId(req.Player) });\n\t\t\tif(!player) return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\n\t\t\tif(!_.isEmpty(req.newNickname)) { await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { nickname: req.newNickname } }); }\n\t\t\tif(!_.isEmpty(req.newPassword)) { await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { password: req.newPassword } }); }\n\t\t\tif(!_.isEmpty(req.newPasscode)) { await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { passcode: req.newPasscode } }); }\n\t\t\tif(!_.isEmpty(req.newInitial)) { await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { 'credit.initial': Number(req.newInitial) } }); }\n\t\t\tif(!_.isEmpty(req.newMaxWin)){ await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { 'wagerLimit.maxWin': Number(req.newMaxWin) } }); }\n\t\t\tif(!_.isEmpty(req.newMinRisk)){ await Player.findOneAndUpdate({ _id: mongoose.Types.ObjectId(req.Player) }, { $set: { 'wagerLimit.minRisk': Number(req.newMinRisk) } }); }\n\n\t\t\tif(req.isSetNewWagerLimit){\n\t\t\t\tawait Player.findOneAndUpdate( { _id: mongoose.Types.ObjectId(req.Player) }, { $set: { \n\t\t\t\t\t'wagerLimit.parlay': req.newParlay,\n\t\t\t\t\t'wagerLimit.parlayTeam': req.newParlayTeam,\n\t\t\t\t\t'wagerLimit.basicTeaser': req.newBasicTeaser,\n\t\t\t\t\t'wagerLimit.basicTeaserTeam': req.newBasicTeaserTeam,\n\t\t\t\t\t'wagerLimit.specialTeaser': req.newSpecialTeaser,\n\t\t\t\t\t'wagerLimit.specialTeaserTeam': req.newSpecialTeaserTeam,\n\t\t\t\t\t'wagerLimit.bigTeaser': req.newBigTeaser,\n\t\t\t\t\t'wagerLimit.bigTeaserTeam': req.newBigTeaserTeam,\n\t\t\t\t\t'wagerLimit.superTeaser': req.newSuperTeaser,\n\t\t\t\t\t'wagerLimit.winReverse': req.newWinReverse,\n\t\t\t\t\t'wagerLimit.winReverseTeam': req.newWinReverseTeam,\n\t\t\t\t\t'wagerLimit.actionReverse': req.newActionReverse,\n\t\t\t\t\t'wagerLimit.actionReverseTeam': req.newActionReverseTeam,\n\t\t\t\t\t'wagerLimit.updatedAt': moment()\n\t\t\t\t}});\n\t\t\t}\n\t\t\tawait SystemLog.create({ title: 'Updated Player', content: `${ctx.user.username} Updated Player ${player.username}`, status: 'success' });\n\t\t\treturn { title: 'Edit', content: 'Successful', status: 'success' };\n\t\t} catch (e) {\n\t\t\tawait SystemLog.create({ title: 'Update Player Failed', content: `${ctx.user.username} Updated Player Failed ${req.Player} ${e}`, status: 'danger' });\n\t\t\treturn { title: 'Unknow Error', content: 'Please try again later!', status: 'danger' };\n\t\t}\n\t},\n\tasync switchUserNotification(root, req, ctx){\n\t\tif(ctx.user.role === 'Guest') return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\tconst user = await User.findOneAndUpdate({ _id: mongoose.Types.ObjectId(ctx.user._id) }, { $set: { ['notification.'+Object.keys(req)[0]]: req[Object.keys(req)[0]] } })\n\t\tif(!user) return { title: 'Not Authenticated', content: 'Please try again.', status: 'warning' };\n\t\treturn { title: ctx.user.username, content: 'success', status: 'success' };\n\t}\n};\n\n\n\n\n\n\n"]}